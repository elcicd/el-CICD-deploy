<flow-definition plugin="workflow-job">
  <displayName>${APP_NAME}</displayName>
  <keepDependencies>false</keepDependencies>
  <properties>
      <org.jenkinsci.plugins.workflow.job.properties.DisableConcurrentBuildsJobProperty />
      ${PIPELINE_PARAMS}
  </properties>
  <definition class="org.jenkinsci.plugins.workflow.cps.CpsFlowDefinition" plugin="workflow-cps">
      <script>  
          node() {
              def cicdMetaData = (readJSON(text: sh(returnStdout: true, script: "oc get cm ${EL_CICD_META_INFO_NAME} -o json")))

              def scmMap = [$class: 'GitSCMSource',
                            remote: ${EL_CICD_GIT_REPO},
                            credentialsId: ${EL_CICD_GIT_REPO_READ_ONLY_GITHUB_PRIVATE_KEY_ID}]
              library(identifier: "el-CICD@${EL_CICD_GIT_REPO_BRANCH_NAME}", retriever: modernSCM(scmMap))

              el.initMetaData(cicdMetaData.data)
          }

          ${EL_CICD_API_CALL}
      </script>
      <sandbox>true</sandbox>
  </definition>
  <triggers />
  <authToken>${AUTH_TOKEN}</authToken>
  <disabled>false</disabled>
</flow-definition>